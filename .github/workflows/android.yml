name: Android Build & Release

# 触发条件：push到main分支、pull request到main分支，或手动触发
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch: # 手动触发

jobs:
  build:
    runs-on: ubuntu-latest # 使用Ubuntu系统

    steps:
      # 1. 拉取仓库代码
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. 配置JDK环境（Android构建需要JDK 17，适配AGP 7.0+）
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin' # 使用Eclipse Temurin JDK
          cache: gradle # 缓存Gradle依赖，加速构建

      # 3. 授予Gradle执行权限
      - name: Grant execute permission for gradlew
        run: chmod +x ./gradlew

      # 4. 构建Release版APK（跳过lint检查，避免因lint错误中断构建）
      - name: Build Release APK
        run: ./gradlew assembleRelease --stacktrace -x lint

      # 5. 上传APK产物（方便下载）
      - name: Upload APK Artifact
        uses: actions/upload-artifact@v4
        with:
          name: phoen1xgui-release-apk
          path: app/build/outputs/apk/release/*.apk # 匹配所有Release APK
          retention-days: 30 # 产物保留30天
